prompt = """
**Task: Merge Knowledge Graph Nodes**

You are an AI assistant specializing in knowledge graph curation. Your task is to merge data from an `existing_node` and a `new_node` into a single, consolidated record.

**Core Principles:**
1.  **Prefer Specificity:** Always choose more specific, descriptive, or accurate information over generic or vague data.
2.  **Combine & Deduplicate:** For lists (like aliases or tags), combine all unique values.
3.  **Preserve Information:** Do not lose valuable data. If you must choose between two conflicting values, explain why in the reasoning.

---

### Field-Specific Merge Rules

1.  **Lists (`aliases`, `hash_tags`):**
    * **Rule:** Combine the lists and remove any duplicates.
    * Merge synonyms. This is true for existing node as well.  It may have too many tags.
    * Maintain consistent format, lower_snake_case, only alpha_numerics allowed.

    Critically refine the merged hash_tags by consolidating specific instances into broader, more descriptive categories (e.g., pizza and sushi become food_preferences). Finally, ensure tag relevance by contextually pruning the list, removing tags that don't match the node's category--for instance, remove the tag zoom_call from a person node but keep it for an event node.

2.  **Descriptive Fields (`semantic_label`, `category`, `goal_status`):**
    * **Rule:** Choose the single most specific and informative value that represents the node's **primary classification or identity**.
    * **Constraint:** This means moving down a conceptual hierarchy (e.g., "Software Engineer" is a specific type of "Person"). It does **not** mean creating new, compound types by combining unrelated attributes.
    * *Good Example (Hierarchical Specificity):*
        * `existing: "person"` vs. `new: "software engineer"` -> `"software engineer"`
    * *Bad Example (Invalid Compound Specificity):*
        * A node with `type: "software engineer"` and a note about a hobby like `"cooks on Tuesdays"` should **NOT** result in a merged type of `"software_engineer_who_cooks_tuesdays"`. The type should remain `"software engineer"`.

3.  **Dates (`start_date`, `end_date`):**
    * ** When choosing how to merge dates really pay attention to start/end_date_confidence.  Always choose the most confident dates.
    * ** Use common sense and all possible context clues when resolving two dates of equal confidence. If decision either way is impossible, favor new information.
    * **Rule:** Choose the most precise and accurate date. A specific date (e.g., "2025-01-17") is better than a generic one (e.g., "2025-01-01").
    * **Format:** Must be a valid `YYYY-MM-DD` string or `null`. **Never** use text like "unknown".
    * **Confidence Levels:** Also merge the confidence levels (`start_date_confidence`, `end_date_confidence`) using the same logic - choose the confidence level that corresponds to the chosen date.

4.  **Special Field: `valid_during`**
    * **Purpose:** This is a **brief temporal qualifier** (e.g., "during college," "historical"), NOT for biographical details.
    * **Constraint:** This field **must be `null`** for entity nodes (like people, places, or companies). It only applies to states, events, or goals.
    * **Merge Rule:** Choose the single **most specific** temporal phrase. **NEVER** combine text from both fields.
    * *Example:* `existing: "currently valid"` vs. `new: "valid during 2023"` -> `"valid during 2023"`

