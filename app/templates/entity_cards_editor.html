<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entity Cards Editor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/entity_cards_editor.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>üìá Entity Cards Editor</h1>
                    <p>Search, edit, and create entity cards for prompt injection</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="openCreateModal()" class="btn-primary" title="Create new entity card">
                        ‚ûï Create New
                    </button>
                </div>
            </div>
        </div>

        <!-- Statistics Panel -->
        <div class="stats-panel">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="stat-total-cards">-</h3>
                    <p>Total Cards</p>
                </div>
                <div class="stat-card success">
                    <h3 id="stat-active-cards">-</h3>
                    <p>Active Cards</p>
                </div>
                <div class="stat-card info">
                    <h3 id="stat-total-usage">-</h3>
                    <p>Total Usage</p>
                </div>
                <div class="stat-card warning">
                    <h3 id="stat-types">-</h3>
                    <p>Entity Types</p>
                </div>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="search-panel">
            <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                <input 
                    type="text" 
                    id="search-input" 
                    placeholder="üîç Search by name, type, or content..." 
                    class="search-input"
                    onkeypress="if(event.key === 'Enter') searchCards()"
                />
                <select id="type-filter" class="filter-select">
                    <option value="">All Types</option>
                </select>
                <select id="sort-select" class="filter-select">
                    <option value="name">Sort by Name</option>
                    <option value="usage">Sort by Usage</option>
                    <option value="created">Sort by Created</option>
                    <option value="updated">Sort by Updated</option>
                </select>
                <button onclick="searchCards()" class="btn-secondary">Search</button>
                <button onclick="clearFilters()" class="btn-secondary">Clear</button>
            </div>
            <div id="search-results-info" style="color: #7f8c8d; font-size: 13px; margin-bottom: 10px;"></div>
        </div>

        <!-- Cards List -->
        <div class="cards-list" id="cards-list">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading entity cards...</p>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination" style="display: none;">
            <button id="prev-btn" onclick="changePage(-1)" class="btn-secondary" disabled>‚Üê Previous</button>
            <span id="page-info">Page 1 of 1</span>
            <button id="next-btn" onclick="changePage(1)" class="btn-secondary" disabled>Next ‚Üí</button>
        </div>
    </div>

    <!-- Edit/Create Modal -->
    <div id="edit-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Edit Entity Card</h2>
                <button onclick="closeEditModal()" class="modal-close">√ó</button>
            </div>
            <div class="modal-body">
                <form id="entity-card-form">
                    <input type="hidden" id="card-id" />
                    
                    <div class="form-group">
                        <label for="entity-name">Entity Name *</label>
                        <input type="text" id="entity-name" required />
                    </div>
                    
                    <div class="form-group">
                        <label for="entity-type">Entity Type *</label>
                        <input type="text" id="entity-type" required list="entity-types-list" />
                        <datalist id="entity-types-list"></datalist>
                    </div>
                    
                    <div class="form-group">
                        <label for="summary">Summary *</label>
                        <textarea id="summary" rows="4" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="key-facts">Key Facts (one per line)</label>
                        <textarea id="key-facts" rows="6" placeholder="Enter each fact on a new line"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="relationships">Relationships (one per line)</label>
                        <textarea id="relationships" rows="6" placeholder="Enter each relationship on a new line"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="aliases">Aliases (comma-separated)</label>
                        <input type="text" id="aliases" placeholder="alias1, alias2, alias3" />
                    </div>
                    
                    <div class="form-group">
                        <label for="original-description">Original Description</label>
                        <textarea id="original-description" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="original-aliases">Original Aliases (comma-separated)</label>
                        <input type="text" id="original-aliases" placeholder="original1, original2" />
                    </div>
                    
                    <div class="form-group">
                        <label for="confidence">Confidence (0.0 - 1.0)</label>
                        <input type="number" id="confidence" min="0" max="1" step="0.01" />
                    </div>
                    
                    <div class="form-group">
                        <label for="source-node-id">Source Node ID (UUID)</label>
                        <input type="text" id="source-node-id" placeholder="Optional: Link to KG node" />
                    </div>
                    
                    <div class="form-group">
                        <label for="card-metadata">Card Metadata (JSON)</label>
                        <textarea id="card-metadata" rows="4" placeholder='{"key": "value"}'></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeEditModal()" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Modal -->
    <div id="view-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="view-modal-title">Entity Card Details</h2>
                <button onclick="closeViewModal()" class="modal-close">√ó</button>
            </div>
            <div class="modal-body" id="view-modal-body">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button onclick="closeViewModal()" class="btn-secondary">Close</button>
                <button onclick="editFromView()" class="btn-primary">Edit</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/entity_cards_editor.js') }}"></script>
</body>
</html>

